<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billing-Nexa Pro | Khagesh ai-nexa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #ffffff; --text: #000000; --card: #f8fafc; }
        .dark-mode { --bg: #0f172a; --text: #ffffff; --card: #1e293b; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; transition: 0.3s; min-height: 100vh; }
        .hidden { display: none !important; }
        #activationScreen { background: #0f172a; min-height: 100vh; display: flex; align-items: center; justify-content: center; position: fixed; inset: 0; z-index: 100; }
        .glass-card { background: var(--card); border: 1px solid rgba(0,0,0,0.05); border-radius: 20px; position: relative; }
    </style>
</head>
<body class="max-w-md mx-auto p-5 pb-24">

    <div id="activationScreen">
        <div class="w-full max-w-xs text-center">
            <h1 class="text-3xl font-black text-sky-400 uppercase italic">BILLING NEXA</h1>
            <div class="bg-white/5 p-8 rounded-[32px] border border-white/10 mt-8 shadow-2xl">
                <input type="text" id="licenseKey" placeholder="TRIAL123" class="w-full p-4 rounded-xl text-center bg-white/10 border border-sky-400/50 text-white mb-4 outline-none">
                <button onclick="activateApp()" class="w-full bg-sky-500 text-white py-4 rounded-xl font-bold uppercase tracking-widest active:scale-95 transition">Unlock Billing</button>
            </div>
        </div>
    </div>

    <div id="mainApp" class="hidden">
        <header class="flex justify-between items-center py-4">
            <div>
                <h1 class="text-2xl font-black italic text-sky-500 uppercase">BILL <span class="opacity-20 text-black dark:text-white">NEXA</span></h1>
                <p class="text-[9px] font-bold opacity-50 uppercase tracking-widest" id="liveClock">00:00:00</p>
            </div>
            <div class="flex gap-2 items-center">
                <div id="trialCounter" class="hidden text-[8px] bg-red-500 text-white px-2 py-1 rounded-full font-bold animate-pulse">-- DAYS</div>
                <button onclick="document.body.classList.toggle('dark-mode')" class="w-8 h-8 rounded-full bg-gray-100 dark:bg-white/5 flex items-center justify-center"><i class="fas fa-moon text-xs"></i></button>
            </div>
        </header>

        <div class="bg-sky-500 p-6 rounded-[28px] my-6 text-white shadow-xl flex justify-between items-center">
            <div>
                <p class="text-[10px] font-bold uppercase opacity-60">Today's Sale</p>
                <h2 id="totalSale" class="text-3xl font-black italic">₹ 0</h2>
            </div>
            <i class="fas fa-chart-line text-3xl opacity-20"></i>
        </div>

        <div class="glass-card p-5 mb-8 shadow-sm">
            <p class="text-[9px] font-bold uppercase opacity-40 mb-3 tracking-widest">New Invoice</p>
            <div class="space-y-3">
                <input type="text" id="custName" placeholder="Customer Name" class="w-full p-3 bg-white dark:bg-transparent border border-gray-200 dark:border-white/10 rounded-xl text-sm outline-none">
                <input type="text" id="itemName" placeholder="Item Name / Service" class="w-full p-3 bg-white dark:bg-transparent border border-gray-200 dark:border-white/10 rounded-xl text-sm outline-none">
                <div class="grid grid-cols-2 gap-2">
                    <input type="number" id="itemPrice" placeholder="Price (₹)" class="p-3 bg-white dark:bg-transparent border border-gray-200 dark:border-white/10 rounded-xl text-sm outline-none">
                    <input type="number" id="itemQty" placeholder="Qty" class="p-3 bg-white dark:bg-transparent border border-gray-200 dark:border-white/10 rounded-xl text-sm outline-none">
                </div>
                <button onclick="generateBill()" class="w-full bg-sky-500 text-white py-4 rounded-xl font-black uppercase text-[10px] tracking-widest active:scale-95 transition">Generate Bill</button>
            </div>
        </div>

        <div id="billList" class="space-y-4"></div>

        <footer class="fixed bottom-0 left-0 w-full p-5 backdrop-blur-lg border-t border-black/5 dark:border-white/5" style="background: var(--bg);">
            <div class="max-w-md mx-auto flex justify-between items-center">
                <div class="flex gap-4 text-gray-400">
                    <a href="mailto:magicalkhagesh888@gmail.com"><i class="fas fa-envelope"></i></a>
                    <a href="https://www.instagram.com/khagesh_ai_nexa" target="_blank"><i class="fab fa-instagram"></i></a>
                    <button onclick="exportBills()" id="backupBtn" class="hidden"><i class="fas fa-file-invoice-dollar text-sky-500"></i></button>
                </div>
                <p class="text-[8px] font-black opacity-30 uppercase tracking-widest">Khagesh ai-nexa</p>
            </div>
        </footer>
    </div>

    <script>
        const KEYS = { trial: "TRIAL123", full: "Permanentkey63793119" };
        
        // --- DATA SAVER ---
        const bVersions = ['bill_data_v1'];
        let bCombined = [];
        bVersions.forEach(v => {
            const d = JSON.parse(localStorage.getItem(v)) || [];
            bCombined = [...bCombined, ...d];
        });
        let billData = Array.from(new Map(bCombined.map(b => [b.id, b])).values());
        localStorage.setItem('bill_data_v1', JSON.stringify(billData));

        function activateApp() {
            const val = document.getElementById('licenseKey').value.trim();
            if(val === KEYS.full) { localStorage.setItem('bill_auth', 'FULL'); launchApp('Permanent'); }
            else if(val === KEYS.trial) { localStorage.setItem('bill_auth', 'TRIAL'); localStorage.setItem('bill_start', Date.now()); launchApp('Trial'); }
        }

        function launchApp(type) {
            document.getElementById('activationScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            if(type === 'Permanent') document.getElementById('backupBtn').classList.remove('hidden');
            else { document.getElementById('trialCounter').classList.remove('hidden'); updateTimer(); }
            render();
        }

        function updateTimer() {
            const start = localStorage.getItem('bill_start');
            setInterval(() => {
                const diff = (2 - (Date.now() - start) / (1000 * 60 * 60 * 24)).toFixed(1);
                document.getElementById('trialCounter').innerText = `${diff} DAYS`;
                if(diff <= 0) { localStorage.removeItem('bill_auth'); location.reload(); }
            }, 1000);
        }

        function generateBill() {
            const n = document.getElementById('custName').value, item = document.getElementById('itemName').value;
            const p = parseFloat(document.getElementById('itemPrice').value) || 0;
            const q = parseFloat(document.getElementById('itemQty').value) || 1;
            if(n && item) {
                const total = p * q;
                billData.unshift({ id: Date.now(), n, item, p, q, total, date: new Date().toLocaleDateString() });
                localStorage.setItem('bill_data_v1', JSON.stringify(billData));
                render();
                document.querySelectorAll('input').forEach(i => i.value = '');
            }
        }

        function deleteBill(id) {
            if(confirm("Delete this bill?")) {
                billData = billData.filter(b => b.id !== id);
                localStorage.setItem('bill_data_v1', JSON.stringify(billData));
                render();
            }
        }

        function render() {
            const list = document.getElementById('billList');
            let grandTotal = 0;
            list.innerHTML = billData.map(b => {
                grandTotal += b.total;
                return `<div class="glass-card p-4">
                    <button onclick="deleteBill(${b.id})" class="absolute top-3 right-3 text-rose-500 opacity-20"><i class="fas fa-trash-alt text-[10px]"></i></button>
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-[7px] opacity-40 uppercase">${b.date}</p>
                            <h3 class="text-xs font-black uppercase italic">${b.n}</h3>
                            <p class="text-[10px] text-sky-500 font-bold">${b.item} (x${b.q})</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-black italic">₹${b.total}</p>
                            <div class="flex gap-2 mt-1">
                                <button onclick="window.open('https://wa.me/918882737014?text=Bill for ${b.n}: ${b.item} - ₹${b.total}')" class="text-emerald-500 text-xs"><i class="fab fa-whatsapp"></i></button>
                                <button onclick="alert('QR for ₹${b.total} generated!')" class="text-sky-500 text-xs"><i class="fas fa-qrcode"></i></button>
                            </div>
                        </div>
                    </div>
                </div>`;
            }).join('');
            document.getElementById('totalSale').innerText = `₹ ${grandTotal}`;
        }

        function exportBills() {
            let win = window.open('', '_blank');
            win.document.write(`<html><head><style>table{width:100%;border-collapse:collapse;} th,td{border:1px solid #eee;padding:12px;text-align:left;} th{background:#0ea5e9;color:white;}</style></head><body>
                <h1 style="color:#0ea5e9">SALES RECORD - NEXA BILLING</h1>
                <table><thead><tr><th>Date</th><th>Customer</th><th>Item</th><th>Qty</th><th>Total</th></tr></thead>
                <tbody>${billData.map(b => `<tr><td>${b.date}</td><td>${b.n}</td><td>${b.item}</td><td>${b.q}</td><td>₹${b.total}</td></tr>`).join('')}</tbody>
                </table><script>window.print();<\/script></body></html>`);
        }

        setInterval(() => { document.getElementById('liveClock').innerText = new Date().toLocaleTimeString(); }, 1000);
        window.onload = () => { if(localStorage.getItem('bill_auth')) launchApp(localStorage.getItem('bill_auth') === 'FULL' ? 'Permanent' : 'Trial'); }
    </script>
</body>
  </html>
  
