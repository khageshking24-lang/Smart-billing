<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexa Pro v7 | Khagesh ai-nexa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&display=swap');
        body { font-family: 'Outfit', sans-serif; background: #f0f4f8; padding-bottom: 120px; transition: 0.3s; }
        .dark-mode { background: #0f172a; color: #f8fafc; }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(15px); border: 1px solid rgba(0,0,0,0.05); border-radius: 28px; }
        .dark-mode .glass { background: #1e293b; border-color: rgba(255,255,255,0.1); }
        .tab-content { display: none; }
        .active-tab { display: block; animation: zoomIn 0.3s ease; }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        .btn-gradient { background: linear-gradient(135deg, #2563eb, #7c3aed); color: white; }
        .history-card { border-left: 4px solid #3b82f6; }
    </style>
</head>
<body id="appBody">

    <div id="lockScreen" class="fixed inset-0 bg-[#0f172a] z-[9999] hidden items-center justify-center">
        <div class="glass p-10 w-80 text-center shadow-2xl border-2 border-blue-500/20">
            <h2 class="text-3xl font-black text-blue-500 mb-2 tracking-tighter">NEXA PRO v7</h2>
            <input type="password" id="keyInput" placeholder="LICENSE KEY" class="w-full p-4 rounded-2xl bg-slate-100 dark:bg-slate-800 mb-6 text-center font-bold outline-none border-2 border-transparent focus:border-blue-500">
            <button onclick="activateApp()" class="w-full btn-gradient py-4 rounded-2xl font-black uppercase tracking-widest active:scale-95 transition">Unlock System</button>
            <p class="mt-6 text-[10px] text-slate-500 font-bold uppercase tracking-widest">magicalkhagesh888@gmail.com</p>
        </div>
    </div>

    <div class="max-w-md mx-auto p-4">
        <header class="flex justify-between items-center mb-6 pt-4 px-2">
            <div>
                <h1 class="text-2xl font-black text-blue-600">Nexa Pro <span class="text-[10px] bg-blue-100 text-blue-600 px-2 py-1 rounded-full ml-1">v7</span></h1>
                <p id="liveTime" class="text-[10px] font-bold opacity-50 uppercase"></p>
            </div>
            <button onclick="toggleMode()" class="w-12 h-12 glass flex items-center justify-center text-blue-500 shadow-xl border-2 border-white"><i class="fas fa-adjust"></i></button>
        </header>

        <div id="quickBill" class="tab-content active-tab">
            <div class="glass p-5 mb-4 shadow-sm border-t-4 border-blue-500">
                <input type="text" id="custName" placeholder="Customer Name" class="w-full p-3 rounded-xl mb-3 bg-slate-50 dark:bg-slate-900 border-none outline-none">
                <input type="tel" id="custPhone" placeholder="WhatsApp Number" class="w-full p-3 rounded-xl mb-3 bg-slate-50 dark:bg-slate-900 border-none outline-none">
                <select id="billItemSelect" class="w-full p-3 rounded-xl mb-3 bg-slate-50 dark:bg-slate-900 font-bold outline-none"></select>
                <input type="number" id="billQty" placeholder="Selling Quantity" class="w-full p-3 rounded-xl mb-3 bg-slate-50 dark:bg-slate-900 border-none outline-none">
                <button onclick="addBillItem()" class="w-full py-3 btn-gradient rounded-xl font-bold text-sm shadow-lg active:scale-95 transition">ADD TO CART</button>
            </div>
            <div id="currentBillList" class="glass p-4 mb-4 min-h-[100px] text-xs font-bold space-y-2"></div>
            <button onclick="generateV7Bill()" class="w-full py-4 bg-emerald-500 text-white rounded-2xl font-black shadow-2xl uppercase tracking-widest active:scale-95 transition">Generate & Print Bill</button>
        </div>

        <div id="customerDiary" class="tab-content">
            <div class="glass p-5 mb-4 border-t-4 border-orange-500">
                <input type="text" id="cName" placeholder="Party Name" class="w-full p-3 rounded-xl mb-2 bg-slate-50 dark:bg-slate-900 outline-none">
                <input type="number" id="cAmount" placeholder="Due Amount ₹" class="w-full p-3 rounded-xl mb-2 bg-slate-50 dark:bg-slate-900 outline-none">
                <button onclick="addUdhaar()" class="w-full py-3 bg-orange-500 text-white rounded-xl font-bold uppercase text-xs">Save Ledger Entry</button>
            </div>
            <div id="udhaarList" class="space-y-3"></div>
        </div>

        <div id="historySection" class="tab-content">
            <h3 class="text-xs font-black uppercase text-slate-400 mb-4 px-2">Recent Transactions</h3>
            <div id="salesHistoryList" class="space-y-3"></div>
        </div>

        <div id="accountsSection" class="tab-content">
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="glass p-5 text-center border-b-4 border-emerald-500">
                    <p class="text-[9px] font-black text-slate-400 uppercase">Net Revenue</p>
                    <p class="text-xl font-black text-emerald-500">₹<span id="repSale">0</span></p>
                </div>
                <div class="glass p-5 text-center border-b-4 border-blue-500">
                    <p class="text-[9px] font-black text-slate-400 uppercase">Net Profit</p>
                    <p class="text-xl font-black text-blue-500">₹<span id="repProfit">0</span></p>
                </div>
            </div>
            <div class="glass p-5 mb-6">
                <div class="flex justify-between text-xs mb-2"><span>Tax Collected (GST):</span><span id="repTax" class="font-bold">₹0</span></div>
                <div class="flex justify-between text-xs mb-2"><span>Total Assets (Stock):</span><span id="repAsset" class="font-bold">₹0</span></div>
            </div>
            <button onclick="downloadBackup()" class="w-full py-5 glass text-blue-600 font-black border-2 border-blue-100 flex items-center justify-center gap-3 active:scale-95 transition shadow-lg">
                <i class="fas fa-cloud-upload-alt"></i> DOWNLOAD DATABASE BACKUP
            </button>
        </div>

        <div id="stockRoom" class="tab-content">
            <div class="glass p-5 mb-4 border-t-4 border-purple-500">
                <input type="text" id="sName" placeholder="Item Name" class="w-full p-3 mb-2 rounded-xl bg-slate-50 dark:bg-slate-900 outline-none">
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <input type="number" id="sPurchase" placeholder="Purchase ₹" class="p-3 rounded-xl bg-slate-50 dark:bg-slate-900 outline-none">
                    <input type="number" id="sPrice" placeholder="Selling ₹" class="p-3 rounded-xl bg-slate-50 dark:bg-slate-900 outline-none">
                </div>
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <input type="number" id="sQty" placeholder="Stock Qty" class="p-3 rounded-xl bg-slate-50 dark:bg-slate-900 outline-none">
                    <select id="sGst" class="p-3 rounded-xl bg-slate-50 dark:bg-slate-900 outline-none">
                        <option value="0">GST 0%</option><option value="5">GST 5%</option><option value="12">GST 12%</option><option value="18">GST 18%</option>
                    </select>
                </div>
                <button onclick="addToStock()" class="w-full py-3 bg-purple-600 text-white rounded-xl font-bold uppercase text-xs">Update Stock</button>
            </div>
            <div id="fullStockList" class="space-y-2"></div>
        </div>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 glass m-4 mb-6 flex justify-around p-3 shadow-2xl border border-white/20">
        <button onclick="switchTab('quickBill', this)" class="text-blue-500 text-xl p-2"><i class="fas fa-plus-circle"></i><p class="text-[8px] font-black mt-1 uppercase">Sale</p></button>
        <button onclick="switchTab('historySection', this)" class="text-slate-400 text-xl p-2"><i class="fas fa-history"></i><p class="text-[8px] font-black mt-1 uppercase">History</p></button>
        <button onclick="switchTab('stockRoom', this)" class="text-slate-400 text-xl p-2"><i class="fas fa-boxes"></i><p class="text-[8px] font-black mt-1 uppercase">Items</p></button>
        <button onclick="switchTab('customerDiary', this)" class="text-slate-400 text-xl p-2"><i class="fas fa-user-tie"></i><p class="text-[8px] font-black mt-1 uppercase">Parties</p></button>
        <button onclick="switchTab('accountsSection', this)" class="text-slate-400 text-xl p-2"><i class="fas fa-chart-pie"></i><p class="text-[8px] font-black mt-1 uppercase">Reports</p></button>
    </nav>

    <script>
        const P_KEY = "Permanentkey63793119";
        const T_KEY = "TEST-20";
        let cart = [];

        function activateApp() {
            const val = document.getElementById('keyInput').value.trim();
            if (val === P_KEY || val === T_KEY) { 
                localStorage.setItem('nexa_access', val === P_KEY ? 'PERMANENT' : 'TRIAL'); 
                if(val === T_KEY) localStorage.setItem('nexa_start', Date.now());
                location.reload(); 
            } else { alert("Invalid Key!"); }
        }

        function switchTab(tabId, btn) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
            document.getElementById(tabId).classList.add('active-tab');
            document.querySelectorAll('nav button').forEach(b => b.classList.replace('text-blue-500', 'text-slate-400'));
            btn.classList.replace('text-slate-400', 'text-blue-500');
            if(tabId === 'historySection') renderHistory();
            if(tabId === 'accountsSection') renderAccounts();
        }

        function addToStock() {
            const name = document.getElementById('sName').value.trim();
            const purchase = Number(document.getElementById('sPurchase').value);
            const price = Number(document.getElementById('sPrice').value);
            const qty = Number(document.getElementById('sQty').value);
            const gst = Number(document.getElementById('sGst').value);
            if(!name || !price) return;
            let stock = JSON.parse(localStorage.getItem('nexa_stock') || '[]');
            const idx = stock.findIndex(i => i.name.toLowerCase() === name.toLowerCase());
            if(idx > -1) { stock[idx].qty += qty; stock[idx].price = price; }
            else { stock.unshift({ id: Date.now(), name, purchase, price, qty, gst }); }
            localStorage.setItem('nexa_stock', JSON.stringify(stock));
            render(); alert("Stock Updated!");
        }

        function addBillItem() {
            const itemId = document.getElementById('billItemSelect').value;
            const qty = Number(document.getElementById('billQty').value);
            let stock = JSON.parse(localStorage.getItem('nexa_stock') || '[]');
            const item = stock.find(i => i.id == itemId);
            if(item && item.qty >= qty) {
                cart.push({ ...item, billQty: qty });
                renderCart();
            } else { alert("Not enough stock!"); }
        }

        function renderCart() {
            document.getElementById('currentBillList').innerHTML = cart.map((i, index) => 
                `<div class="flex justify-between bg-blue-50 dark:bg-slate-800 p-2 rounded-lg">
                    <span>${i.name} (x${i.billQty})</span>
                    <span>₹${i.price * i.billQty} <button onclick="cart.splice(${index},1);renderCart()" class="text-red-500 ml-2"><i class="fas fa-times-circle"></i></button></span>
                </div>`
            ).join('');
        }

        function generateV7Bill() {
            if(cart.length === 0) return;
            const cName = document.getElementById('custName').value || "Cash Customer";
            const cPhone = document.getElementById('custPhone').value;
            let stock = JSON.parse(localStorage.getItem('nexa_stock') || '[]');
            let saleVal = 0; let profitVal = 0; let taxVal = 0;

            cart.forEach(c => {
                const s = stock.find(si => si.id === c.id);
                if(s) {
                    s.qty -= c.billQty;
                    let tax = (c.price * c.gst / 100) * c.billQty;
                    taxVal += tax;
                    saleVal += (c.price * c.billQty) + tax;
                    profitVal += (c.price - c.purchase) * c.billQty;
                }
            });

            // Save History
            let history = JSON.parse(localStorage.getItem('nexa_history') || '[]');
            history.unshift({ id: Date.now(), customer: cName, amount: saleVal, date: new Date().toLocaleString() });
            localStorage.setItem('nexa_history', JSON.stringify(history));

            localStorage.setItem('nexa_stock', JSON.stringify(stock));
            localStorage.setItem('nexa_sales_total', Number(localStorage.getItem('nexa_sales_total') || 0) + saleVal);
            localStorage.setItem('nexa_profit_total', Number(localStorage.getItem('nexa_profit_total') || 0) + profitVal);
            localStorage.setItem('nexa_tax_total', Number(localStorage.getItem('nexa_tax_total') || 0) + taxVal);

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(18); doc.text("NEXA PRO TAX INVOICE", 14, 20);
            doc.autoTable({ startY: 25, head: [['Item', 'Qty', 'Rate', 'Total']], body: cart.map(i => [i.name, i.billQty, i.price, (i.price*i.billQty)]) });
            doc.save(`Bill_${cName}.pdf`);

            if(cPhone) window.open(`https://wa.me/91${cPhone}?text=Invoice for ₹${saleVal.toFixed(2)} generated.`);
            cart = []; renderCart(); render();
        }

        function renderHistory() {
            let history = JSON.parse(localStorage.getItem('nexa_history') || '[]');
            document.getElementById('salesHistoryList').innerHTML = history.map(h => `
                <div class="glass p-4 history-card flex justify-between items-center shadow-sm">
                    <div><p class="font-black text-sm">${h.customer}</p><p class="text-[9px] opacity-50">${h.date}</p></div>
                    <span class="text-emerald-600 font-black">₹${h.amount.toFixed(2)}</span>
                </div>
            `).join('');
        }

        function addUdhaar() {
            const name = document.getElementById('cName').value.trim();
            const amt = document.getElementById('cAmount').value;
            if(!name || !amt) return;
            let udhaars = JSON.parse(localStorage.getItem('nexa_udhaar') || '[]');
            udhaars.unshift({ id: Date.now(), name, amt, date: new Date().toLocaleDateString() });
            localStorage.setItem('nexa_udhaar', JSON.stringify(udhaars));
            render(); document.getElementById('cName').value = ''; document.getElementById('cAmount').value = '';
        }

        function settleUdhaar(id) {
            if(confirm("Mark as PAID and Remove?")) {
                let udhaars = JSON.parse(localStorage.getItem('nexa_udhaar') || '[]');
                udhaars = udhaars.filter(u => u.id !== id);
                localStorage.setItem('nexa_udhaar', JSON.stringify(udhaars));
                render();
            }
        }

        function renderAccounts() {
            document.getElementById('repSale').innerText = Number(localStorage.getItem('nexa_sales_total') || 0).toFixed(2);
            document.getElementById('repProfit').innerText = Number(localStorage.getItem('nexa_profit_total') || 0).toFixed(2);
            document.getElementById('repTax').innerText = "₹" + Number(localStorage.getItem('nexa_tax_total') || 0).toFixed(2);
            let stock = JSON.parse(localStorage.getItem('nexa_stock') || '[]');
            let val = stock.reduce((a, c) => a + (c.purchase * c.qty), 0);
            document.getElementById('repAsset').innerText = "₹" + val.toFixed(2);
        }

        function downloadBackup() {
            const data = { stock: localStorage.getItem('nexa_stock'), history: localStorage.getItem('nexa_history'), udhaar: localStorage.getItem('nexa_udhaar'), sales: localStorage.getItem('nexa_sales_total'), profit: localStorage.getItem('nexa_profit_total') };
            const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = `Nexa_Pro_Backup_${Date.now()}.json`; a.click();
        }

        function render() {
            let stock = JSON.parse(localStorage.getItem('nexa_stock') || '[]');
            document.getElementById('fullStockList').innerHTML = stock.map(i => `<div class="glass p-3 flex justify-between text-xs font-bold border-r-4 ${i.qty < 5 ? 'border-red-500' : 'border-emerald-500'}"><span>${i.name}</span><span>Stock: ${i.qty}</span></div>`).join('');
            document.getElementById('billItemSelect').innerHTML = stock.map(i => `<option value="${i.id}">${i.name} (₹${i.price})</option>`).join('');
            let udhaars = JSON.parse(localStorage.getItem('nexa_udhaar') || '[]');
            document.getElementById('udhaarList').innerHTML = udhaars.map(u => `
                <div class="glass p-4 flex justify-between items-center shadow-sm">
                    <div><p class="font-black">${u.name}</p><p class="text-[9px] opacity-40">${u.date}</p></div>
                    <div class="flex items-center gap-3"><span class="text-orange-600 font-bold">₹${u.amt}</span>
                    <button onclick="settleUdhaar(${u.id})" class="bg-emerald-500 text-white px-3 py-1 rounded-full text-[10px] font-black uppercase">Settle</button></div>
                </div>
            `).join('');
        }

        function toggleMode() { document.getElementById('appBody').classList.toggle('dark-mode'); }
        setInterval(() => { document.getElementById('liveTime').innerText = new Date().toLocaleString(); }, 1000);
        const access = localStorage.getItem('nexa_access');
        if(!access) document.getElementById('lockScreen').classList.replace('hidden', 'flex');
        render();
    </script>
</body>
            </html>
            
