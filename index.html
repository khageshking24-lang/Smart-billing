<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexa Pro v15 | Unlimited Titanium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&display=swap');
        body { font-family: 'Outfit', sans-serif; background: #f1f5f9; color: #1e293b; transition: 0.4s; padding-bottom: 100px; }
        .dark-mode { background: #010409; color: #e6edf3; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border: 1px solid rgba(0,0,0,0.1); border-radius: 28px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .dark-mode .glass { background: #0d1117; border-color: rgba(255,255,255,0.05); }
        .input-nexa { background: #ffffff; border: 1.5px solid #e2e8f0; border-radius: 16px; padding: 14px; width: 100%; outline: none; transition: 0.3s; }
        .dark-mode .input-nexa { background: #161b22; border-color: #30363d; color: white; }
        .input-nexa:focus { border-color: #3b82f6; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }
        .tab-content { display: none; }
        .active-tab { display: block; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .btn-grad { background: linear-gradient(135deg, #2563eb, #7c3aed); color: white; font-weight: 800; transition: 0.3s; }
        .btn-grad:active { scale: 0.95; }
    </style>
</head>
<body id="appBody">

    <div class="max-w-md mx-auto p-4">
        <header class="flex justify-between items-center mb-8 pt-4">
            <div>
                <h1 class="text-3xl font-black tracking-tighter text-blue-600">NEXA <span class="text-indigo-500 italic">V15</span></h1>
                <p id="liveTime" class="text-[9px] font-bold opacity-50 uppercase tracking-widest"></p>
            </div>
            <div class="flex gap-2">
                <button onclick="downloadBackup()" class="w-11 h-11 glass flex items-center justify-center text-blue-600 shadow-lg"><i class="fas fa-cloud-upload-alt"></i></button>
                <button onclick="toggleMode()" class="w-11 h-11 glass flex items-center justify-center text-orange-500 shadow-lg"><i class="fas fa-adjust"></i></button>
            </div>
        </header>

        <div id="billingTab" class="tab-content active-tab">
            <div class="glass p-6 mb-4 border-t-8 border-blue-600">
                <div class="mb-4">
                    <label class="text-[10px] font-black uppercase opacity-40 mb-1 block">Business Branding (Logo)</label>
                    <input type="file" id="logoInp" class="text-[10px] w-full file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700">
                </div>
                <div class="flex gap-2 mb-3">
                    <input type="text" id="cName" placeholder="Client Name" class="input-nexa w-2/3">
                    <input type="tel" id="cPhone" placeholder="WhatsApp" class="input-nexa w-1/3">
                </div>
                <select id="itemSelect" class="input-nexa mb-3 font-bold"></select>
                <div class="flex gap-2">
                    <input type="number" id="bQty" placeholder="Quantity" class="input-nexa w-1/2">
                    <button onclick="addItem()" class="w-1/2 btn-grad rounded-2xl text-xs uppercase">Add to Cart</button>
                </div>
            </div>
            <div id="cartBox" class="glass p-4 mb-4 min-h-[60px] space-y-2 text-xs font-bold border-dashed border-2 border-slate-200 dark:border-slate-800"></div>
            <button onclick="printInvoice()" class="w-full py-5 bg-slate-900 text-white dark:bg-blue-700 rounded-3xl font-black shadow-2xl uppercase tracking-tighter flex items-center justify-center gap-3">
                <i class="fas fa-file-invoice-dollar text-xl"></i> Generate GSTR Invoice
            </button>
        </div>

        <div id="ledgerTab" class="tab-content">
            <div class="glass p-6 mb-4 border-t-4 border-orange-500">
                <h3 class="text-xs font-black text-orange-600 mb-4 uppercase">New Udhaar Entry</h3>
                <input type="text" id="uName" placeholder="Party Name" class="input-nexa mb-2">
                <input type="number" id="uAmt" placeholder="Balance Amount ₹" class="input-nexa mb-4">
                <button onclick="addUdhaar()" class="w-full py-4 bg-orange-500 text-white rounded-2xl font-black uppercase text-xs">Save To Party Ledger</button>
            </div>
            <div id="ledgerList" class="space-y-3"></div>
        </div>

        <div id="reportTab" class="tab-content">
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="glass p-5 border-l-4 border-blue-500">
                    <p class="text-[8px] font-black opacity-50 uppercase">Total Sales</p>
                    <p class="text-xl font-black">₹<span id="statSale">0</span></p>
                </div>
                <div class="glass p-5 border-l-4 border-emerald-500">
                    <p class="text-[8px] font-black opacity-50 uppercase">Net Profit</p>
                    <p class="text-xl font-black text-emerald-500">₹<span id="statProfit">0</span></p>
                </div>
            </div>
            <div class="glass p-6 border-t-4 border-indigo-600">
                <h3 class="text-xs font-black text-indigo-600 mb-6 uppercase tracking-widest flex items-center gap-2">
                    <i class="fas fa-chart-bar"></i> Professional GSTR-1 Summary
                </h3>
                <div class="space-y-4 text-xs font-bold">
                    <div class="flex justify-between border-b border-slate-100 dark:border-slate-800 pb-2"><span>Taxable Value:</span><span id="gstTaxable">₹0.00</span></div>
                    <div class="flex justify-between border-b border-slate-100 dark:border-slate-800 pb-2"><span>CGST (9%):</span><span id="gstCgst">₹0.00</span></div>
                    <div class="flex justify-between border-b border-slate-100 dark:border-slate-800 pb-2"><span>SGST (9%):</span><span id="gstSgst">₹0.00</span></div>
                    <div class="flex justify-between pt-2 text-lg font-black text-indigo-600"><span>TOTAL GST:</span><span id="gstTotal">₹0.00</span></div>
                </div>
                <button onclick="downloadGSTR()" class="w-full mt-8 py-4 bg-indigo-600 text-white font-black rounded-2xl text-[10px] uppercase shadow-lg">Download PDF Report</button>
            </div>
        </div>

        <div id="stockTab" class="tab-content">
            <div class="glass p-6 mb-4">
                <input type="text" id="sName" placeholder="Item Name" class="input-nexa mb-2">
                <div class="flex gap-2 mb-2">
                    <input type="number" id="sBuy" placeholder="Buy ₹" class="input-nexa">
                    <input type="number" id="sSell" placeholder="Sell ₹" class="input-nexa">
                </div>
                <div class="flex gap-2 mb-4">
                    <input type="number" id="sQty" placeholder="Initial Qty" class="input-nexa w-2/3">
                    <select id="sGst" class="input-nexa w-1/3 text-xs font-bold"><option value="0">0%</option><option value="5">5%</option><option value="12">12%</option><option value="18">18%</option></select>
                </div>
                <button onclick="saveStock()" class="w-full py-4 btn-grad rounded-2xl font-black uppercase text-[10px]">Add Item to Database</button>
            </div>
            <div id="stockList" class="space-y-2"></div>
        </div>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 glass m-4 mb-6 flex justify-around p-3 shadow-2xl border border-white/20">
        <button onclick="switchTab('billingTab', this)" class="text-blue-600 text-xl p-2"><i class="fas fa-plus-circle"></i><p class="text-[8px] font-black uppercase mt-1">Sale</p></button>
        <button onclick="switchTab('stockTab', this)" class="text-slate-400 text-xl p-2"><i class="fas fa-warehouse"></i><p class="text-[8px] font-black uppercase mt-1">Stock</p></button>
        <button onclick="switchTab('ledgerTab', this)" class="text-slate-400 text-xl p-2"><i class="fas fa-book"></i><p class="text-[8px] font-black uppercase mt-1">Ledger</p></button>
        <button onclick="switchTab('reportTab', this)" class="text-slate-400 text-xl p-2"><i class="fas fa-chart-pie"></i><p class="text-[8px] font-black uppercase mt-1">GSTR</p></button>
    </nav>

    <script>
        let cart = [];
        let logoData = null;

        // Logo Handler
        document.getElementById('logoInp').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = () => logoData = reader.result;
            reader.readAsDataURL(e.target.files[0]);
        });

        function switchTab(id, btn) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
            document.getElementById(id).classList.add('active-tab');
            document.querySelectorAll('nav button').forEach(b => b.classList.replace('text-blue-600', 'text-slate-400'));
            btn.classList.replace('text-slate-400', 'text-blue-600');
            if(id === 'reportTab') renderStats();
        }

        // DATABASE STORAGE (UNLIMITED LOGIC)
        function saveStock() {
            const name = document.getElementById('sName').value;
            const buy = Number(document.getElementById('sBuy').value);
            const sell = Number(document.getElementById('sSell').value);
            const qty = Number(document.getElementById('sQty').value);
            const gst = Number(document.getElementById('sGst').value);
            if(!name || !sell) return;
            let stock = JSON.parse(localStorage.getItem('n_stock') || '[]');
            stock.unshift({ id: Date.now(), name, buy, sell, qty, gst });
            localStorage.setItem('n_stock', JSON.stringify(stock));
            render(); alert("Item Added To Unlimited Storage!");
        }

        function addItem() {
            const id = document.getElementById('itemSelect').value;
            const qty = Number(document.getElementById('bQty').value);
            let stock = JSON.parse(localStorage.getItem('n_stock') || '[]');
            const item = stock.find(i => i.id == id);
            if(item && item.qty >= qty) {
                cart.push({ ...item, bQty: qty });
                renderCart();
            } else { alert("Insufficient Stock!"); }
        }

        function renderCart() {
            document.getElementById('cartBox').innerHTML = cart.map(i => `<div class="flex justify-between p-3 bg-white dark:bg-slate-800 rounded-xl"><span>${i.name} (x${i.bQty})</span><span>₹${(i.sell * i.bQty).toFixed(2)}</span></div>`).join('');
        }

        function printInvoice() {
            if(cart.length === 0) return;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            if(logoData) doc.addImage(logoData, 'PNG', 14, 10, 30, 30);
            doc.setFontSize(22); doc.text("TAX INVOICE", 14, 50);
            
            let tTax = 0; let tSale = 0; let tProf = 0;
            const rows = cart.map(i => {
                let tax = (i.sell * i.gst / 100) * i.bQty;
                let total = (i.sell * i.bQty) + tax;
                tTax += tax; tSale += total; tProf += (i.sell - i.buy) * i.bQty;
                return [i.name, i.bQty, i.sell.toFixed(2), i.gst+'%', total.toFixed(2)];
            });

            doc.autoTable({ startY: 55, head: [['Item', 'Qty', 'Rate', 'GST', 'Total']], body: rows });
            doc.text(`GRAND TOTAL: Rs. ${tSale.toFixed(2)}`, 14, doc.lastAutoTable.finalY + 15);
            
            // Save Data
            localStorage.setItem('n_sale', Number(localStorage.getItem('n_sale') || 0) + tSale);
            localStorage.setItem('n_tax', Number(localStorage.getItem('n_tax') || 0) + tTax);
            localStorage.setItem('n_prof', Number(localStorage.getItem('n_prof') || 0) + tProf);
            
            // Deduct Stock
            let stock = JSON.parse(localStorage.getItem('n_stock') || '[]');
            cart.forEach(c => { let s = stock.find(si => si.id === c.id); if(s) s.qty -= c.bQty; });
            localStorage.setItem('n_stock', JSON.stringify(stock));

            doc.save("Nexa_Invoice.pdf");
            const phone = document.getElementById('cPhone').value;
            if(phone) window.open(`https://wa.me/91${phone}?text=Hello! Your invoice for ₹${tSale.toFixed(2)} is ready.`);
            cart = []; renderCart(); render();
        }

        function addUdhaar() {
            const name = document.getElementById('uName').value;
            const amt = document.getElementById('uAmt').value;
            if(!name || !amt) return;
            let list = JSON.parse(localStorage.getItem('n_udhaar') || '[]');
            list.unshift({ id: Date.now(), name, amt, date: new Date().toLocaleDateString() });
            localStorage.setItem('n_udhaar', JSON.stringify(list));
            render();
        }

        function settle(id) {
            let list = JSON.parse(localStorage.getItem('n_udhaar') || '[]');
            list = list.filter(u => u.id !== id);
            localStorage.setItem('n_udhaar', JSON.stringify(list));
            render();
        }

        function downloadBackup() {
            const data = { stock: localStorage.getItem('n_stock'), sale: localStorage.getItem('n_sale'), tax: localStorage.getItem('n_tax'), prof: localStorage.getItem('n_prof'), udhaar: localStorage.getItem('n_udhaar') };
            const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = `Nexa_Final_Backup.json`; a.click();
        }

        function downloadGSTR() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const tax = Number(localStorage.getItem('n_tax') || 0);
            const sale = Number(localStorage.getItem('n_sale') || 0);
            doc.setFontSize(20); doc.text("GSTR-1 MONTHLY REPORT", 14, 20);
            doc.autoTable({ startY: 30, head: [['Category', 'Amount (INR)']], body: [['Taxable Value', (sale-tax).toFixed(2)], ['CGST (9%)', (tax/2).toFixed(2)], ['SGST (9%)', (tax/2).toFixed(2)], ['Total GST', tax.toFixed(2)]] });
            doc.save("GSTR_Report.pdf");
        }

        function renderStats() {
            const s = Number(localStorage.getItem('n_sale') || 0);
            const p = Number(localStorage.getItem('n_prof') || 0);
            const t = Number(localStorage.getItem('n_tax') || 0);
            document.getElementById('statSale').innerText = s.toFixed(0);
            document.getElementById('statProfit').innerText = p.toFixed(0);
            document.getElementById('gstTaxable').innerText = "₹" + (s - t).toFixed(2);
            document.getElementById('gstTotal').innerText = "₹" + t.toFixed(2);
            document.getElementById('gstCgst').innerText = "₹" + (t/2).toFixed(2);
            document.getElementById('gstSgst').innerText = "₹" + (t/2).toFixed(2);
        }

        function render() {
            let stock = JSON.parse(localStorage.getItem('n_stock') || '[]');
            document.getElementById('stockList').innerHTML = stock.map(i => `<div class="glass p-4 flex justify-between font-bold border-l-4 ${i.qty < 5 ? 'border-red-500' : 'border-blue-500'}"><span>${i.name}</span><span>Stock: ${i.qty}</span></div>`).join('');
            document.getElementById('itemSelect').innerHTML = stock.map(i => `<option value="${i.id}">${i.name} (₹${i.sell})</option>`).join('');
            let udhaar = JSON.parse(localStorage.getItem('n_udhaar') || '[]');
            document.getElementById('ledgerList').innerHTML = udhaar.map(u => `<div class="glass p-4 flex justify-between items-center"><div><p class="font-black text-sm">${u.name}</p><p class="text-[9px] opacity-40">${u.date}</p></div><div class="flex items-center gap-3"><span class="text-orange-600 font-bold">₹${u.amt}</span><button onclick="settle(${u.id})" class="bg-emerald-500 text-white px-4 py-1 rounded-full text-[9px] font-black uppercase shadow-md">Settle</button></div></div>`).join('');
        }

        function toggleMode() { document.getElementById('appBody').classList.toggle('dark-mode'); }
        setInterval(() => { document.getElementById('liveTime').innerText = new Date().toLocaleString(); }, 1000);
        render();
    </script>
</body>
                    </html>
                    
